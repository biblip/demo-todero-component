# Todero Component Runner Guide

This document explains how to use `todero-component-runner` to execute a
component locally without starting the full Todero server.

## What the Runner Does

The runner loads component JARs from a workspace directory, constructs a
`CommandContext`, and executes a component command directly. It prints
responses and events to stdout for quick local testing and debugging.

## Requirements

- Java 17
- A built component JAR
- The `todero-component-runner` JAR (built from this repo)
- A workspace directory with a `components/` subdirectory

## Workspace Layout

The runner expects this structure:

```
<workspace>/
  components/
    your-component/
      your-component.jar
```

## Build the Runner

From the repo root:

```
./mvnw -pl todero-component-runner -am package
```

The JAR will be in:

```
todero-component-runner/target/todero-component-runner-<version>.jar
```

## Build a Component

If the component is in this repo:

```
./mvnw -pl components-develop/<your-component> -am package
```

Copy the component JAR into `<workspace>/components`.

## Run a Command

Command syntax:

```
java -jar todero-component-runner.jar \
  --workspace-dir /path/to/workspace \
  --component com.example.todero.component.template \
  --command ping \
  --body "hello"
```

Arguments:
- `--workspace-dir` path containing the `components/` directory
- `--component` component name (must match the componentâ€™s controller name)
- `--command` command name to execute
- `--body` optional request body string

## What You Will See

- `context.response(...)` output is printed to stdout.
- `context.event(...)` output is printed with a `[event <name>]` prefix.

## Debugging in IntelliJ

1) Create a Run/Debug configuration:
   - **Type**: Application
   - **Main class**: `com.social100.todero.component.runner.ComponentRunnerMain`
   - **Use classpath of module**: `todero-component-runner`
   - **Program arguments**: same as the CLI example above

2) Set breakpoints in the component code.

3) Start the configuration in Debug mode.

## Common Issues

- **Component not found**: ensure the JAR is in `<workspace>/components` and the
  `--component` value matches the `@AIAController` name. The runner expects one
  jar inside a component subdirectory.
- **No output**: verify the command exists and that the action calls
  `context.response(...)`.
- **Classpath issues**: rebuild the component JAR and ensure you are pointing
  to the correct workspace directory.
- **Component API version errors**: the JAR must include
  `META-INF/todero-component-api.properties` with `componentApiVersion`.
- **Missing component.properties**: the JAR must include `component.properties`
  generated by the processor.
